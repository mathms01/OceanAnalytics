{
	"name": "WhalesCsvToMongoDbTest",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "WhalesOccurence_Prod",
						"type": "DatasetReference"
					},
					"name": "WhalesCsv"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "OceanAnalytics_CosmosDbNoSql",
						"type": "LinkedServiceReference"
					},
					"name": "exporttocosmodb"
				}
			],
			"transformations": [
				{
					"name": "idgenerate"
				},
				{
					"name": "selectcolumns"
				},
				{
					"name": "filterdatescientificnamelocation"
				}
			],
			"scriptLines": [
				"source(output(",
				"          id as string,",
				"          dataset_id as string,",
				"          decimallongitude as string,",
				"          decimallatitude as string,",
				"          date_start as string,",
				"          date_mid as string,",
				"          date_end as string,",
				"          date_year as string,",
				"          scientificname as string,",
				"          originalscientificname as string,",
				"          minimumdepthinmeters as string,",
				"          maximumdepthinmeters as string,",
				"          depth as string,",
				"          coordinateuncertaintyinmeters as string,",
				"          flags as string,",
				"          dropped as string,",
				"          absence as string,",
				"          shoredistance as string,",
				"          bathymetry as string,",
				"          sst as string,",
				"          sss as string,",
				"          marine as string,",
				"          brackish as string,",
				"          freshwater as string,",
				"          terrestrial as string,",
				"          taxonrank as string,",
				"          aphiaid as string,",
				"          redlist_category as string,",
				"          superdomain as string,",
				"          domain as string,",
				"          kingdom as string,",
				"          subkingdom as string,",
				"          infrakingdom as string,",
				"          phylum as string,",
				"          phylum_division as string,",
				"          subphylum_subdivision as string,",
				"          subphylum as string,",
				"          infraphylum as string,",
				"          parvphylum as string,",
				"          gigaclass as string,",
				"          megaclass as string,",
				"          superclass as string,",
				"          class as string,",
				"          subclass as string,",
				"          infraclass as string,",
				"          subterclass as string,",
				"          superorder as string,",
				"          order as string,",
				"          suborder as string,",
				"          infraorder as string,",
				"          parvorder as string,",
				"          superfamily as string,",
				"          family as string,",
				"          subfamily as string,",
				"          supertribe as string,",
				"          tribe as string,",
				"          subtribe as string,",
				"          genus as string,",
				"          subgenus as string,",
				"          section as string,",
				"          subsection as string,",
				"          series as string,",
				"          species as string,",
				"          subspecies as string,",
				"          natio as string,",
				"          variety as string,",
				"          subvariety as string,",
				"          forma as string,",
				"          subforma as string,",
				"          type as string,",
				"          modified as string,",
				"          language as string,",
				"          license as string,",
				"          rightsholder as string,",
				"          accessrights as string,",
				"          bibliographiccitation as string,",
				"          references as string,",
				"          institutionid as string,",
				"          collectionid as string,",
				"          datasetid as string,",
				"          institutioncode as string,",
				"          collectioncode as string,",
				"          datasetname as string,",
				"          ownerinstitutioncode as string,",
				"          basisofrecord as string,",
				"          informationwithheld as string,",
				"          datageneralizations as string,",
				"          dynamicproperties as string,",
				"          materialsampleid as string,",
				"          occurrenceid as string,",
				"          catalognumber as string,",
				"          occurrenceremarks as string,",
				"          recordnumber as string,",
				"          recordedby as string,",
				"          recordedbyid as string,",
				"          individualcount as string,",
				"          organismquantity as string,",
				"          organismquantitytype as string,",
				"          sex as string,",
				"          lifestage as string,",
				"          reproductivecondition as string,",
				"          behavior as string,",
				"          establishmentmeans as string,",
				"          occurrencestatus as string,",
				"          preparations as string,",
				"          disposition as string,",
				"          othercatalognumbers as string,",
				"          associatedmedia as string,",
				"          associatedreferences as string,",
				"          associatedsequences as string,",
				"          associatedtaxa as string,",
				"          organismid as string,",
				"          organismname as string,",
				"          organismscope as string,",
				"          associatedoccurrences as string,",
				"          associatedorganisms as string,",
				"          previousidentifications as string,",
				"          organismremarks as string,",
				"          eventid as string,",
				"          parenteventid as string,",
				"          samplingprotocol as string,",
				"          samplesizevalue as string,",
				"          samplesizeunit as string,",
				"          samplingeffort as string,",
				"          eventdate as string,",
				"          eventtime as string,",
				"          startdayofyear as string,",
				"          enddayofyear as string,",
				"          year as string,",
				"          month as string,",
				"          day as string,",
				"          verbatimeventdate as string,",
				"          habitat as string,",
				"          fieldnumber as string,",
				"          fieldnotes as string,",
				"          eventremarks as string,",
				"          locationid as string,",
				"          highergeographyid as string,",
				"          highergeography as string,",
				"          continent as string,",
				"          waterbody as string,",
				"          islandgroup as string,",
				"          island as string,",
				"          country as string,",
				"          countrycode as string,",
				"          stateprovince as string,",
				"          county as string,",
				"          municipality as string,",
				"          locality as string,",
				"          verbatimlocality as string,",
				"          verbatimelevation as string,",
				"          minimumelevationinmeters as string,",
				"          maximumelevationinmeters as string,",
				"          verbatimdepth as string,",
				"          minimumdistanceabovesurfaceinmeters as string,",
				"          maximumdistanceabovesurfaceinmeters as string,",
				"          locationaccordingto as string,",
				"          locationremarks as string,",
				"          verbatimcoordinates as string,",
				"          verbatimlatitude as string,",
				"          verbatimlongitude as string,",
				"          verbatimcoordinatesystem as string,",
				"          verbatimsrs as string,",
				"          geodeticdatum as string,",
				"          coordinateprecision as string,",
				"          pointradiusspatialfit as string,",
				"          footprintwkt as string,",
				"          footprintsrs as string,",
				"          footprintspatialfit as string,",
				"          georeferencedby as string,",
				"          georeferenceddate as string,",
				"          georeferenceprotocol as string,",
				"          georeferencesources as string,",
				"          georeferenceverificationstatus as string,",
				"          georeferenceremarks as string,",
				"          geologicalcontextid as string,",
				"          earliesteonorlowesteonothem as string,",
				"          latesteonorhighesteonothem as string,",
				"          earliesteraorlowesterathem as string,",
				"          latesteraorhighesterathem as string,",
				"          earliestperiodorlowestsystem as string,",
				"          latestperiodorhighestsystem as string,",
				"          earliestepochorlowestseries as string,",
				"          latestepochorhighestseries as string,",
				"          earliestageorloweststage as string,",
				"          latestageorhigheststage as string,",
				"          lowestbiostratigraphiczone as string,",
				"          highestbiostratigraphiczone as string,",
				"          lithostratigraphicterms as string,",
				"          group as string,",
				"          formation as string,",
				"          member as string,",
				"          bed as string,",
				"          identificationid as string,",
				"          identifiedby as string,",
				"          identifiedbyid as string,",
				"          dateidentified as string,",
				"          identificationreferences as string,",
				"          identificationremarks as string,",
				"          identificationqualifier as string,",
				"          identificationverificationstatus as string,",
				"          typestatus as string,",
				"          taxonid as string,",
				"          scientificnameid as string,",
				"          acceptednameusageid as string,",
				"          parentnameusageid as string,",
				"          originalnameusageid as string,",
				"          nameaccordingtoid as string,",
				"          namepublishedinid as string,",
				"          taxonconceptid as string,",
				"          acceptednameusage as string,",
				"          parentnameusage as string,",
				"          originalnameusage as string,",
				"          nameaccordingto as string,",
				"          namepublishedin as string,",
				"          namepublishedinyear as string,",
				"          higherclassification as string,",
				"          specificepithet as string,",
				"          infraspecificepithet as string,",
				"          verbatimtaxonrank as string,",
				"          scientificnameauthorship as string,",
				"          vernacularname as string,",
				"          nomenclaturalcode as string,",
				"          taxonomicstatus as string,",
				"          nomenclaturalstatus as string,",
				"          taxonremarks as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: true,",
				"     maxColumns: 1000) ~> WhalesCsv",
				"filterdatescientificnamelocation derive(id = uuid()) ~> idgenerate",
				"WhalesCsv select(mapColumn(",
				"          internal_id = id,",
				"          scientific_name = scientificname,",
				"          depth,",
				"          is_deleted = absence,",
				"          latitude = decimallatitude,",
				"          longitude = decimallongitude,",
				"          locality,",
				"          minimum_depth_in_meters = minimumdepthinmeters,",
				"          maximum_depth_in_meters = maximumdepthinmeters,",
				"          record_way = basisofrecord,",
				"          shore_distance = shoredistance,",
				"          event_date = eventdate",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectcolumns",
				"selectcolumns filter(!isNull(event_date) && !isNull(scientific_name) && !isNull(latitude) && !isNull(longitude)) ~> filterdatescientificnamelocation",
				"idgenerate sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'document',",
				"     container: 'whales_analytical_store',",
				"     deletable: false,",
				"     insertable: true,",
				"     updateable: false,",
				"     upsertable: true,",
				"     partitionKey: ['/scientific_name/internal_id'],",
				"     store: 'cosmosDB',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     preCommands: [],",
				"     postCommands: []) ~> exporttocosmodb"
			]
		}
	}
}